---
title: "Assignment-2"
date: "January 28, 2017"
output: html_document
---

**Data: In this problem set we will use the nycflights13 R package that contains data for all
flights that departed NYC (i.e. JFK, LGA or EWR) in 2013.**


```{r}
install.packages("nycflights13", repos = "http://cran.us.r-project.org") #install package
library(nycflights13)                                                    # load data package
data(flights)                                                            # load data on flights
library(dplyr)                                                           # load dplyr package

#understanding the data
summary(flights)
attach(flights)
unique(carrier)
unique(origin)
unique(dest)
detach(flights)
```

**1. Let's explore flights from NYC to Seattle. Use the flights dataset to answer the following
questions.
a) (2 pt) How many flights were there to and from NYC in 2013?**

Number of flights from NYC:
```{r}
unique(flights$origin)           # Validate all the flights originate from NYC
nrow(flights)                    # Number of flights from NYC is equal to the number of rows in the dataframe
```
Number of flights to NYC:
```{r}
NYC_airports <- c("JFK","LGA","EWR")                                                           #3 airports in NYC in a variable to help with pattern matching
flight_to_NYC <- grep(paste(NYC_airports,collapse="|"),flights$dest, ignore.case=TRUE, value=TRUE) #finding the rows where dest in ("JFK","EWR","LGA")
length(flight_to_NYC)                                                                              #Length of vector to determine no. of flights to NYC
```

**b) (2 pt) How many flights were there from NYC airports to Seattle (SEA) in 2013?**

```{r}
flights_to_Sea <- subset(flights, flights$dest =="SEA")     #subset the flights dataframe for dest="SEA"
nrow(flights_to_Sea)                            
```

**c) (2 pt) How many airlines fly from NYC to Seattle? Hint: look at the function unique()**
```{r}
unique(flights_to_Sea[,"carrier"])                      #identify unique carriers that fly from NYC to SEA
nrow(unique(flights_to_Sea[,"carrier"]))            
```

**d) (2 pt) What is the average arrival delay for flights from NYC to Seattle? Hint: if there are
missing values in the vector you want the mean of, you have to remove them. Try the following:
mean(c(1,2,3,NA))
and
mean(c(1,2,3,NA), na.rm=T)**

```{r}
levels(as.factor(is.na(flights_to_Sea$arr_delay)))  #identify the presence of missing values in data set

mean(flights_to_Sea$arr_delay, na.rm=T)             #calculate mean ignoring NA values
```

**2. Flights are often delayed. Consider the following questions exploring delay patterns.**
**a) (4 pt) What is the mean arrival delay time? What is the median arrival delay time?**
Mean arrival delay time:
```{r}
mean(flights$arr_delay, na.rm=T)
```
Median arrival delay time:
```{r}
median(flights$arr_delay, na.rm=T)
```

**b) (2 pt) What does a negative arrival delay mean?**
It implies that the flights are arriving before the scheduled time.

**c) (4 pt) Plot a histogram of arrival delay times. Does the answers you obtained in (a)
consistent with the shape of the delay time distribution?**
```{r}
hist(flights$arr_delay, breaks=100, xaxt="n")
axis(side=1, at=seq(-100,500,5))
abline(v=mean(flights$arr_delay, na.rm=T), col = 3)
abline(v=median(flights$arr_delay, na.rm=T), col = 4)
legend("topright", cex=0.70, legend=c("Median","Mean"), lty = c(1,1), lwd = c(1,1), col = c(3,4))
```
  
Yes, the answers obtained in (a) are consistent with the shape of the delay time distribution. Ideally, in a right skewed distribution, median < mean

**d) (4 pt) Is there seasonality in departure delays? Try
by(flights$dep_delay, flights$month, function(x) mean(x, na.rm=T))
and describe what patterns you see. Is there a best month to leave New York? A worst?
Why might this be?**
```{r}
x <- by(flights$dep_delay, flights$month, function(x) mean(x, na.rm=T))
x
barplot(x)
```
  
The mean departure varies by month. The mean departure delay times steadily increase from January to July, except for a dip experienced in the month of May. Post July, the average departure delay times decrease until the holiday season in Dec which has a high spike in departure delay time.

The best month to leave New York is November, closely followed by October and Septemeber. This can be due to the off-season period. i.e. the air traffic is limited as the demand for travelling is considerably less during this season.
The worst month to leave New York is July closely followed by June and December due to the following reasons:

The average departure delays are high during the summer holidays (June - July) and the winter holidays (Dec). 
1)NYC is an important connecting departure hub to Europe which is a popular summer holiday destinations. Air traffic can cause departure delays
2)The weather conditions in Dec such as snow causes flight delays. 



**3. EDA**
**a) (4 pt) Plot a histogram of the total air flight time with 100 breaks. (look at the help for
hist()). How many peaks do you see in this distribution? What is an explanation for this?**

```{r}
mean(flights$air_time,na.rm = T)
hist(flights$air_time, breaks=100)
```
  
There are 7 peaks in this distribution with a prominent peaks around 50 minutes and between 100-200 minutes total air flight time. A possible reason for this is that the count of flights departing from NYC to destinations in the total air time range of around 50 minutes is high. For example, total number of flights to Boston in the 2013 were 15508 with a mean air time of 38 minutes.
As seen in the top ten destinations below based on number of flights in 2013, 5/10 flights have a total air time between 100-200 minutes. The high number of short flights is due to the fact that NYC is a connecting hub and a popular point of arrival to the US.



```{r}
flights_per_dest <- flights %>%
  group_by(dest) %>%
  summarise(count = n())
top_dest <- arrange(flights_per_dest, desc(count))
top_dest

mean_time_per_dest <- flights %>%
  group_by(dest) %>%
  summarise(mean_time = mean(air_time, na.rm=T))
mean_time_per_dest <- arrange(mean_time_per_dest,mean_time)
head(mean_time_per_dest,15)

a <- merge(top_dest,mean_time_per_dest,by="dest")
head(arrange(a,desc(count)),10)
```

**b) (4 pt) What time of day do flights most commonly depart? Why might there be two most
popular times of day to depart?**


```{r}
time_of_day <- flights %>%
  group_by(sched_dep_time) %>%
  summarise(count = n())%>%
  arrange(desc(count))

time_of_day
```
The flights most commonly depart in the morning around at 6 a.m. Morning times are popular times to depart.
Apart from the morning time, from the histogram below, it is observed that the other most popular time of the day is in the afternoon around 1200.
```{r}
hist(flights$sched_dep_time, breaks=100)
```


```{r}
morn_flights <- subset(flights, flights$hour==6)
avg_dep_delay_morn <- mean(morn_flights$dep_delay, na.rm=T)
cat('avg_dep_delay_morn = ',avg_dep_delay_morn)  
cat("\n")

avg_dep_delay <- mean(flights$dep_delay, na.rm=T)
cat('avg_dep_delay = ',avg_dep_delay)  
cat("\n")


avg_arr_delay_morn <- mean(morn_flights$arr_delay, na.rm=T)
cat('avg_arr_delay_morn = ',avg_arr_delay_morn) 
cat("\n")


avg_arr_delay <- mean(flights$arr_delay, na.rm=T)
cat('avg_arr_delay = ',avg_arr_delay) 
cat("\n")
```
Flights departing in the morning around 6 am have a considerably less departure delay than the mean delay throughout the day. Additionally, morning flights departing from NYC are preferred are they allow for more time during the day at the destinations which are in different time-zones.

Similarly afternoon flights are popular as the departure time is convenient.



**c) (4 pt) Plot a box plot of departure delays and hour of departure. What pattern do you
see? What is an explanation for this?**
```{r}
boxplot(flights$dep_delay~flights$hour, ylim=c(-50,50))
```
  
The boxplot shows that the median of the departure delays across the hours is close to 0. However, the IQR is prominently higher after the hours 1400 which implies that the departure delays times are much more than those observed in the morning i.e the amount of time by which the flights are delayed is much more after 1400 than in the early hours of the day.


**4. (10 pt) Develop one research question you can address using the nycflights2013 dataset.
Provide two visualizations to support your exploration of this question. Discuss what you find.**

Among the top 3 flight destinations from NYC in 2013, is there a common carrier that contributes to the total delay time (dep_delay + arr_delay)?

```{r}
flights$total_delay <- flights$dep_delay + flights$arr_delay

total_delay <- flights %>%
  group_by(dest) %>%
  summarise(count=n(), mean_delay = mean(total_delay, na.rm=T))
  
top_total_delay <- arrange(filter(total_delay, count>10000),desc(mean_delay))

top_total_delay


v <- head(top_total_delay,3)

v$dest <- as.factor(v$dest)

plot(v$dest,v$mean_delay)

```

```{r}
#target_dest <- c()
carriers_dest1 <- filter(flights, grepl('ATL',dest))

total_delay1 <- carriers_dest1 %>%
  group_by(carrier) %>%
  summarise(mean_delay = mean(total_delay, na.rm=T))

total_delay1<- arrange(total_delay1, desc(mean_delay))
total_delay1


carriers_dest2 <- filter(flights, grepl('FLL',dest))

total_delay2 <- carriers_dest2 %>%
  group_by(carrier) %>%
  summarise(mean_delay = mean(total_delay, na.rm=T))

total_delay2<- arrange(total_delay2, desc(mean_delay))
total_delay2

carriers_dest3 <- filter(flights, grepl('ORD',dest))

total_delay3 <- carriers_dest3 %>%
  group_by(carrier) %>%
  summarise(mean_delay = mean(total_delay, na.rm=T))

total_delay3<- arrange(total_delay3, desc(mean_delay))
total_delay3

total_delay1$carrier <- as.factor(total_delay1$carrier)
total_delay2$carrier <- as.factor(total_delay2$carrier)
total_delay3$carrier <- as.factor(total_delay3$carrier)

par(mfrow=c(3,1))
plot(total_delay1$carrier, total_delay1$mean_delay)
plot(total_delay2$carrier, total_delay2$mean_delay,pch=2)
plot(total_delay3$carrier, total_delay3$mean_delay,pch=8)
```
  
It is observed that UA is the only common carrier among the top 3 destinations from NYC. Although not always with the highest total delay, UA seems to have a contributing impact in flight delays across these three destinations.
